stages:
  - triggers
  - scan

default:
  image: debian:11
  tags:
    - docker

trigger_oscap:
  stage: triggers
  trigger:
    include: build_dependencies/oscap.yml
    strategy: depend
  when: always

run-security-scan:
  stage: scan
  script:
    - echo "Run security scan"
# run-security-scan:
#   stage: scan
#   # tags:
#   #   - shell
#   before_script:
#     - mkdir -p ~/.ssh
#     - cp -f "$SSH_PRIVATE_KEY" ~/.ssh/id_rsa
#     - chmod 400 ~/.ssh/id_rsa
#     # - rm -f ~/.ssh/known_hosts
#   needs: ["trigger_oscap"]
#   script:
#     - ansible-playbook playbooks/security-scan/main.yml
#   artifacts:
#     paths:
#       - reports
# after_script:
#   - rm ~/.ssh/id_rsa
